<!DOCTYPE html>
<html lang="ja">
	<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>クリップボードから画像を保存</title>
    <style>
			body {
				font-family: Arial, sans-serif;
				text-align: center;
				margin: 50px;
			}

			textarea {
				width: 80%;
				height: 200px;
				margin-bottom: 20px;
			}

			button {
				padding: 10px 20px;
				font-size: 16px;
			}

			img {
				max-width: 100%;
				margin-top: 20px;
			}
    </style>
	</head>
	<body>
    <h1>クリップボードから画像を保存</h1>
    <textarea id="clipboard" placeholder="ここに画像を貼り付けてください"></textarea>
    <button id="saveButton">ファイルとして保存</button>
    <div id="imageContainer"></div>
    <script>
        document.getElementById('clipboard').addEventListener('paste', async (event) => {
            const items = event.clipboardData.items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.startsWith('image/')) {
                    const file = items[i].getAsFile();
                    const url = URL.createObjectURL(file);
                    const img = document.createElement('img');
                    img.src = url;
                    document.getElementById('imageContainer').innerHTML = ''; // 既存の画像をクリア
                    document.getElementById('imageContainer').appendChild(img);
                }
            }
        });

        document.getElementById('saveButton').addEventListener('click', async () => {
            const images = document.querySelectorAll('#imageContainer img');
            if (images.length === 0) {
                alert('画像がありません。クリップボードから画像を貼り付けてください。');
                return;
            }

            const fileHandle = await window.showSaveFilePicker({
                suggestedName: 'image.png',
                types: [{
                    description: 'PNG Images',
                    accept: {'image/png': ['.png']},
                }],
            });

            const blob = await fetch(images[0].src).then(res => res.blob());
            const writable = await fileHandle.createWritable();
            await writable.write(blob);
        await writable.close();
    });
  </script>
	</body>
</html>
